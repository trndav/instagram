<% # See only posts of users who you follow %>
<%= turbo_stream.append :posts do %>
    <% @posts.each do |post| %>
      <% if user_signed_in? && current_user.following?(post.user) %>
          <%= render post %>
      <% # If user not signed in, show all posts but not all, one by one %>  
      <% elsif !user_signed_in? %>
        <%= render post %>
      <% end %>
    <% end %>
  <% end %>
<% # If next pagination is available replace it %>
<% if @pagy.next.present? %>
    <%= turbo_stream.replace :pagination do %>
        <%= turbo_frame_tag :pagination, loading: :lazy,
                        src: posts_path(format: :turbo_stream, page: @pagy.next) %>
    <% end %>
<% end %>